<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="inertial_macros.xacro"/>

    <material name="black"><color rgba="0 0 0 1"/></material>
    <material name="grey"><color rgba="0.5 0.5 0.5 1"/></material>
    <material name="blue"><color rgba="0 0 0.8 1"/></material>
    <material name="red"><color rgba="0.8 0 0 1"/></material>
    <material name="green"><color rgba="0 0.8 0 1"/></material>

    <link name="base_link"></link>

    <joint name="chassis_joint" type="fixed">
        <parent link="base_link"/><child link="chassis"/>
        <origin xyz="-0.126 0 0.04687"/>
    </joint>
    <link name="chassis">
        <visual><origin xyz="0.126 0 0.0225"/><geometry><box size="0.2524 0.2304 0.045"/></geometry><material name="black"/></visual>
        <collision><origin xyz="0.126 0 0.0225"/><geometry><box size="0.2524 0.2304 0.045"/></geometry></collision>
        <xacro:inertial_box mass="2.5" x="0.2524" y="0.2304" z="0.045"><origin xyz="0.126 0 0.0225"/></xacro:inertial_box>
    </link>

    <xacro:macro name="fender" params="prefix y_reflect">
        <joint name="${prefix}_fender_joint" type="fixed">
            <parent link="chassis"/>
            <child link="${prefix}_fender"/>
            <origin xyz="0.126 ${y_reflect * 0.1152} 0.045"/>
        </joint>
        <link name="${prefix}_fender">
            <visual>
                <origin xyz="0 ${y_reflect * 0.0125} -0.015"/><geometry><box size="0.28 0.025 0.03"/></geometry>
                <material name="black"/>
            </visual>
        </link>
    </xacro:macro>
    <xacro:fender prefix="left" y_reflect="1"/><xacro:fender prefix="right" y_reflect="-1"/>

    <xacro:macro name="pillar" params="prefix x_off y_off">
        <joint name="${prefix}_pillar_joint" type="fixed"><parent link="chassis"/><child link="${prefix}_pillar"/><origin xyz="${0.126 + x_off} ${y_off} 0.045"/></joint>
        <link name="${prefix}_pillar">
            <visual><origin xyz="0 0 0.0225"/><geometry><cylinder radius="0.005" length="0.045"/></geometry><material name="grey"/></visual>
        </link>
    </xacro:macro>
    <xacro:pillar prefix="fl" x_off="0.05" y_off="0.06"/><xacro:pillar prefix="fr" x_off="0.05" y_off="-0.06"/>
    <xacro:pillar prefix="rl" x_off="-0.05" y_off="0.06"/><xacro:pillar prefix="rr" x_off="-0.05" y_off="-0.06"/>

    <joint name="upper_platform_joint" type="fixed"><parent link="chassis"/><child link="upper_platform"/><origin xyz="0.126 0 0.090"/></joint>
    <link name="upper_platform">
        <visual><origin xyz="0 0 0.0225"/><geometry><box size="0.14 0.152 0.045"/></geometry><material name="black"/></visual>
        <collision><origin xyz="0 0 0.0225"/><geometry><box size="0.14 0.152 0.045"/></geometry></collision>
        <xacro:inertial_box mass="0.5" x="0.14" y="0.152" z="0.045"><origin xyz="0 0 0.0225"/></xacro:inertial_box>
    </link>

    <xacro:macro name="wheel" params="prefix x_off y_off">
        <joint name="${prefix}_wheel_joint" type="continuous"><parent link="base_link"/><child link="${prefix}_wheel"/><origin xyz="${x_off} ${y_off} 0.04687" rpy="-${pi/2} 0 0"/><axis xyz="0 0 1"/></joint>
        <link name="${prefix}_wheel">
            <visual><geometry><cylinder radius="0.04687" length="0.04"/></geometry><material name="grey"/></visual>
            <collision><geometry><cylinder radius="0.04687" length="0.04"/></geometry></collision>
            <xacro:inertial_cylinder mass="0.2" length="0.04" radius="0.04687"><origin xyz="0 0 0"/></xacro:inertial_cylinder>
        </link>
    </xacro:macro>
    <xacro:wheel prefix="front_left" x_off="0.10" y_off="0.115"/><xacro:wheel prefix="mid_left" x_off="0.0" y_off="0.115"/><xacro:wheel prefix="back_left" x_off="-0.10" y_off="0.115"/>
    <xacro:wheel prefix="front_right" x_off="0.10" y_off="-0.115"/><xacro:wheel prefix="mid_right" x_off="0.0" y_off="-0.115"/><xacro:wheel prefix="back_right" x_off="-0.10" y_off="-0.115"/>

    <joint name="laser_base_joint" type="fixed"><parent link="upper_platform"/><child link="laser_base"/><origin xyz="0.025 0 0.045"/></joint>
    <link name="laser_base">
        <visual><origin xyz="0 0 0.01"/><geometry><box size="0.04 0.04 0.02"/></geometry><material name="grey"/></visual>
    </link>
    <joint name="laser_joint" type="fixed"><parent link="laser_base"/><child link="laser_frame"/><origin xyz="0 0 0.02"/></joint>
    <link name="laser_frame">
        <visual><origin xyz="0 0 0.01"/><geometry><cylinder radius="0.02" length="0.02"/></geometry><material name="blue"/></visual>
        <collision><origin xyz="0 0 0.01"/><geometry><cylinder radius="0.02" length="0.02"/></geometry></collision>
    </link>

    <joint name="camera_stand_joint" type="fixed"><parent link="upper_platform"/><child link="camera_stand"/><origin xyz="-0.02 0 0.045"/></joint>
    <link name="camera_stand">
        <visual>
            <origin xyz="0 0 0.015"/> <geometry><box size="0.05 0.04 0.03"/></geometry>
            <material name="black"/>
        </visual>
    </link>

    <joint name="camera_pan_joint" type="continuous"><parent link="camera_stand"/><child link="camera_pan_link"/><origin xyz="0 0 0.03"/><axis xyz="0 0 1"/></joint>
    <link name="camera_pan_link">
            <visual>
                <origin xyz="0 0 0.04"/> <geometry><cylinder radius="0.015" length="0.08"/></geometry>
                <material name="grey"/>
            </visual>
            <collision>
                <origin xyz="0 0 0.04"/> <geometry><cylinder radius="0.015" length="0.08"/></geometry>
            </collision>
            <xacro:inertial_cylinder mass="0.05" length="0.08" radius="0.015">
                <origin xyz="0 0 0.04"/>
            </xacro:inertial_cylinder>
        </link>

    <joint name="camera_tilt_joint" type="revolute">
        <parent link="camera_pan_link"/>
        <child link="camera_head"/>
        <origin xyz="0 0 0.08"/> <axis xyz="0 1 0"/>
        <limit lower="-1.57" upper="1.57" effort="10" velocity="1.0"/>
    </joint>
    <link name="camera_head">
        <visual>
            <origin xyz="0 0 0.025"/> <geometry><box size="0.05 0.05 0.05"/></geometry>
            <material name="red"/>
        </visual>
        <collision>
            <origin xyz="0 0 0.025"/>
            <geometry><box size="0.05 0.05 0.05"/></geometry>
        </collision>
        <xacro:inertial_box mass="0.1" x="0.05" y="0.05" z="0.05"><origin xyz="0 0 0.025"/></xacro:inertial_box>
    </link>

    <xacro:macro name="antenna" params="prefix y_off">
        <joint name="${prefix}_antenna_joint" type="fixed"><parent link="upper_platform"/><child link="${prefix}_antenna"/><origin xyz="-0.068 ${y_off} 0.045" rpy="0 -0.1 0"/></joint>
        <link name="${prefix}_antenna">
            <visual><origin xyz="0 0 0.075"/><geometry><cylinder radius="0.003" length="0.15"/></geometry><material name="green"/></visual>
        </link>
    </xacro:macro>
    <xacro:antenna prefix="left" y_off="0.05"/><xacro:antenna prefix="right" y_off="-0.05"/>

</robot>